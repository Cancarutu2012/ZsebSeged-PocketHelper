<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindenes Seg√©d</title>
    <style>
        :root {
            --bg-color: #F2F2F2;
            --card-bg: #FFFFFF;
            --accent: #1A1A1A;
            --btn-sec: #EBEBEB;
            --text-main: #000000;
            --text-sub: #7E7E7E;
            --radius: 28px;
        }

        body.dark-mode {
            --bg-color: #000000;
            --card-bg: #1C1C1E;
            --accent: #FFFFFF;
            --btn-sec: #2C2C2E;
            --text-main: #FFFFFF;
            --text-sub: #8E8E93;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            padding-bottom: 120px;
            transition: all 0.3s ease;
        }

        .user-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .user-header h1 { font-size: 24px; margin: 0; }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        button {
            background: var(--accent);
            color: var(--bg-color);
            border: none;
            padding: 15px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }

        button.secondary { background: var(--btn-sec); color: var(--text-main); }
        button.off-btn { background: #FF3B30; color: white; }

        input, select {
            background: var(--btn-sec);
            border: none;
            padding: 12px;
            border-radius: 15px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
            color: var(--text-main);
            outline: none;
        }

        /* Navig√°ci√≥ */
        .bottom-nav {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 500px; background: #1A1A1A; height: 75px;
            border-radius: 38px; display: flex; justify-content: space-around;
            align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); z-index: 1000;
        }
        
        .nav-item { cursor: pointer; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .nav-item img { width: 24px; height: 24px; filter: brightness(0) invert(1); opacity: 0.5; }
        .nav-item.active { background: rgba(255,255,255,0.15); }
        .nav-item.active img { opacity: 1; }

        .view { display: none; }
        .view.active { display: block; }

        /* Gal√©ria r√°cs */
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-top: 15px; }
        .gallery-item { position: relative; aspect-ratio: 1/1; overflow: hidden; cursor: pointer; }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; }
        .date-overlay { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.6); color: white; font-size: 10px; text-align: center; opacity: 0; }
        .gallery-item.show-date .date-overlay { opacity: 1; }
    </style>
</head>
<body>

    <div class="user-header">
        <div>
            <p id="today-date" style="font-size: 12px; color: var(--text-sub); margin: 0;"></p>
            <h1 id="view-title">Eszk√∂z√∂k</h1>
        </div>
    </div>

    <div id="view-tools" class="view active">
        <div class="card">
            <div id="display" style="font-size: 32px; text-align: right; font-weight: bold; margin-bottom: 10px;">0</div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                <button class="secondary" onclick="append('7')">7</button><button class="secondary" onclick="append('8')">8</button><button class="secondary" onclick="append('9')">9</button><button onclick="append('/')">/</button>
                <button class="secondary" onclick="append('4')">4</button><button class="secondary" onclick="append('5')">5</button><button class="secondary" onclick="append('6')">6</button><button onclick="append('*')">*</button>
                <button class="secondary" onclick="append('1')">1</button><button class="secondary" onclick="append('2')">2</button><button class="secondary" onclick="append('3')">3</button><button onclick="append('-')">-</button>
                <button class="secondary" onclick="clearCalc()">C</button><button class="secondary" onclick="append('0')">0</button><button onclick="calculate()">=</button><button onclick="append('+')">+</button>
            </div>
        </div>
        <div class="card">
            <h3>V√°lt√≥k</h3>
            <input type="number" id="conv-input" placeholder="M√©rt√©kegys√©g √©rt√©k...">
            <div style="display:flex; gap:5px;">
                <select id="conv-from" onchange="filterUnits()"></select><select id="conv-to"></select>
            </div>
            <button onclick="convertUnits()">√Åtv√°lt√°s</button>
            <p id="conv-res" style="text-align:center; font-size:14px;"></p>
        </div>
        <div class="card">
            <h3>Valuta (Online)</h3>
            <input type="number" id="curr-input" placeholder="√ñsszeg...">
            <div style="display:flex; gap:5px;">
                <select id="curr-from"></select><select id="curr-to"></select>
            </div>
            <button onclick="convertCurrency()">√Åtv√°lt√°s</button>
            <p id="curr-res" style="text-align:center; font-size:14px;"></p>
        </div>
    </div>

    <div id="view-shop" class="view">
        <div class="card">
            <h2>Lista</h2>
            <div style="display: flex; gap: 5px;"><input type="text" id="shop-input" style="margin:0"><button onclick="addItem()" style="width:50px">+</button></div>
            <div id="shop-list" style="margin-top:15px"></div>
        </div>
    </div>

    <div id="view-mem" class="view">
        <div class="card">
            <h2>Eml√©kek</h2>
            <input type="file" id="img-input" accept="image/*" style="display:none" onchange="saveMem(this)">
            <button id="mem-btn" onclick="document.getElementById('img-input').click()">√öj k√©p</button>
            <div id="gallery" class="gallery-grid"></div>
        </div>
    </div>

    <div id="view-torch" class="view">
        <div class="card" style="text-align: center;">
            <div style="font-size: 50px; margin: 20px;">üî¶</div>
            <h2>Zsebl√°mpa</h2>
            <button onclick="torchOn()">BEKAPCSOL√ÅS</button>
            <button class="off-btn" onclick="torchOff()">KIKAPCSOL√ÅS</button>
            <p id="console" style="color: var(--text-sub); font-size: 12px; margin-top: 10px;">√Ållapot: Ismeretlen</p>
        </div>
    </div>

    <div id="view-settings" class="view">
        <div class="card">
            <h2>Be√°ll√≠t√°sok</h2>
            <button class="secondary" onclick="toggleDarkMode()">S√∂t√©t m√≥d</button>
            <button onclick="resetAll()" style="background:#FF3B30; color:white;">√ñsszes adat t√∂rl√©se</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="nav('tools', this)"><img src="tools.png"></div>
        <div class="nav-item" onclick="nav('shop', this)"><img src="shoplist.png"></div>
        <div class="nav-item" onclick="nav('mem', this)"><img src="memories.png"></div>
        <div class="nav-item" onclick="nav('torch', this)"><img src="torch.png"></div>
        <div class="nav-item" onclick="nav('settings', this)"><img src="settings.png"></div>
    </nav>

    <script>
        // --- ZSEBL√ÅMPA FUNKCI√ìK ---
        let torchTrack = null;

        function torchOn() {
            const consoleOutput = document.getElementById("console");
            if (!('mediaDevices' in navigator)) {
                consoleOutput.innerText = "Hiba: mediaDevices nem t√°mogatott.";
                return;
            }

            navigator.mediaDevices.enumerateDevices().then(devices => {
                const cameras = devices.filter((device) => device.kind === 'videoinput');
                if (cameras.length === 0) {
                    consoleOutput.innerText = "Hiba: Nem tal√°lhat√≥ kamera.";
                    return;
                }
                const camera = cameras[cameras.length - 1];

                navigator.mediaDevices.getUserMedia({
                    video: {
                        deviceId: camera.deviceId,
                        facingMode: ['user', 'environment'],
                        height: {ideal: 1080},
                        width: {ideal: 1920}
                    }
                }).then(stream => {
                    torchTrack = stream.getVideoTracks()[0];
                    const imageCapture = new ImageCapture(torchTrack);
                    imageCapture.getPhotoCapabilities().then(() => {
                        torchTrack.applyConstraints({
                            advanced: [{torch: true}]
                        });
                        consoleOutput.innerText = "√Ållapot: VIL√ÅG√çT";
                    });
                }).catch(err => {
                    consoleOutput.innerText = "Hiba: " + err;
                });
            });
        }

        function torchOff() {
            const consoleOutput = document.getElementById("console");
            if (torchTrack) {
                try {
                    torchTrack.applyConstraints({ advanced: [{ torch: false }] });
                    torchTrack.stop(); // Le√°ll√≠tja a kamer√°t teljesen
                    torchTrack = null;
                    consoleOutput.innerText = "√Ållapot: KIKAPCSOLVA";
                } catch (err) {
                    consoleOutput.innerText = "Hiba a kikapcsol√°skor: " + err;
                }
            } else {
                consoleOutput.innerText = "√Ållapot: M√°r ki van kapcsolva.";
            }
        }

        // --- EML√âKEK ---
       // --- EML√âKEK (MEMORIES) JAV√çTOTT ---
// --- EML√âKEK (MEMORIES) JAV√çTOTT √âS T√ñM√ñR√çTETT ---
function saveMem(input) {
    if (!input.files || !input.files[0]) return;

    const reader = new FileReader();
    reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
            // K√âP √öJR M√âRETEZ√âSE (T√∂m√∂r√≠t√©s)
            const canvas = document.createElement('canvas');
            const MAX_WIDTH = 800; // El√©g nagy a min≈ës√©ghez, de el√©g kicsi a t√°rhelyhez
            let width = img.width;
            let height = img.height;

            if (width > height) {
                if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                }
            } else {
                if (height > MAX_WIDTH) {
                    width *= MAX_WIDTH / height;
                    height = MAX_WIDTH;
                }
            }

            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            // K√©p kinyer√©se gyeng√©bb min≈ës√©gben (0.7 = 70% min≈ës√©g)
            const dataUrl = canvas.toDataURL('image/jpeg', 0.7);

            const m = JSON.parse(localStorage.getItem('m')) || {};
            const now = new Date();
            const dateKey = now.toLocaleDateString('hu-HU') + " " + 
                            now.toLocaleTimeString('hu-HU', {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            
            m[dateKey] = dataUrl;
            
            try {
                localStorage.setItem('m', JSON.stringify(m));
                renderMem();
            } catch (err) {
                alert("A t√°rhely m√©g mindig tele van. Pr√≥b√°ld meg t√∂r√∂lni az app adatait a be√°ll√≠t√°sokban!");
            }
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
}

function renderMem() {
    const g = document.getElementById('gallery');
    if (!g) return;
    
    const m = JSON.parse(localStorage.getItem('m')) || {};
    g.innerHTML = '';
    
    const keys = Object.keys(m).sort().reverse();
    
    const infoText = document.getElementById('mem-info');
    if(infoText) {
        infoText.innerText = keys.length === 0 ? "Kattints a felt√∂lt√©shez." : "Koppints a k√©pre a d√°tum√©rt!";
    }

    keys.forEach(d => {
        const div = document.createElement('div');
        div.className = 'gallery-item';
        div.onclick = function() { this.classList.toggle('show-date'); };
        
        div.innerHTML = `
            <img src="${m[d]}" loading="lazy">
            <div class="date-overlay">${d}</div>
        `;
        g.appendChild(div);
    });
}
        // --- ALAP APP FUNKCI√ìK ---
        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            el.classList.add('active');
            document.getElementById('view-title').innerText = {tools:'Eszk√∂z√∂k', shop:'Lista', mem:'Eml√©kek', torch:'Zsebl√°mpa', settings:'Be√°ll√≠t√°sok'}[id];
            if(id === 'mem') renderMem();
        }

        let ex = "";
        function append(v) { ex += v; document.getElementById('display').innerText = ex; }
        function clearCalc() { ex = ""; document.getElementById('display').innerText = "0"; }
        function calculate() { try { ex = eval(ex).toString(); document.getElementById('display').innerText = ex; } catch { ex = "0"; }}

        const units = { hossz: { m: 1, cm: 0.01, mm: 0.001, km: 1000 }, suly: { g: 1, kg: 1000, t: 1000000 } };
        function initUnits() {
            const f = document.getElementById('conv-from');
            Object.keys(units).forEach(c => Object.keys(units[c]).forEach(u => f.add(new Option(u, `${c}:${u}`))));
            filterUnits();
        }
        function filterUnits() {
            const [c] = document.getElementById('conv-from').value.split(':');
            const t = document.getElementById('conv-to'); t.innerHTML = '';
            Object.keys(units[c]).forEach(u => t.add(new Option(u, u)));
        }
        function convertUnits() {
            const v = parseFloat(document.getElementById('conv-input').value);
            const [c, f] = document.getElementById('conv-from').value.split(':'), t = document.getElementById('conv-to').value;
            if (isNaN(v)) return;
            document.getElementById('conv-res').innerText = (v * units[c][f] / units[c][t]).toLocaleString();
        }

        async function loadCurrencies() {
            const r = await fetch('https://api.frankfurter.app/currencies');
            const d = await r.json();
            const f = document.getElementById('curr-from'), t = document.getElementById('curr-to');
            Object.keys(d).forEach(c => { f.add(new Option(c, c)); t.add(new Option(c, c)); });
            f.value = "EUR"; t.value = "HUF";
        }
        async function convertCurrency() {
            const a = document.getElementById('curr-input').value, f = document.getElementById('curr-from').value, t = document.getElementById('curr-to').value;
            if (!a) return;
            const r = await fetch(`https://api.frankfurter.app/latest?amount=${a}&from=${f}&to=${t}`);
            const d = await r.json();
            document.getElementById('curr-res').innerText = d.rates[t].toLocaleString() + " " + t;
        }

        let items = JSON.parse(localStorage.getItem('l')) || [];
        function renderShop() {
            const c = document.getElementById('shop-list'); c.innerHTML = '';
            items.forEach((it, i) => c.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; background:var(--btn-sec); border-radius:10px; margin-bottom:5px;">${it}<span onclick="del(${i})" style="color:red">‚úï</span></div>`);
            localStorage.setItem('l', JSON.stringify(items));
        }
        function addItem() { const i = document.getElementById('shop-input'); if(i.value){items.push(i.value); i.value=''; renderShop();}}
        function del(i) { items.splice(i,1); renderShop(); }

        function toggleDarkMode() { localStorage.setItem('dark', document.body.classList.toggle('dark-mode')); }
        function resetAll() { if(confirm("T√∂rl√©s?")){localStorage.clear(); location.reload();}}

        // START
        alert("A zsebl√°mpa funkci√≥ csak Chrome-ban biztos, √©s kamera enged√©ly kell hozz√°!");
        document.getElementById('today-date').innerText = new Date().toLocaleDateString('hu-HU', {weekday:'long', month:'long', day:'numeric'});
        if(localStorage.getItem('dark') === 'true') document.body.classList.add('dark-mode');
        initUnits(); loadCurrencies(); renderShop();
    </script>
</body>
</html>


