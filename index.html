<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiApp Pro Max + Torch</title>
    <style>
        :root {
            --bg-color: #F2F2F2;
            --card-bg: #FFFFFF;
            --accent: #1A1A1A;
            --btn-sec: #EBEBEB;
            --text-main: #000000;
            --text-sub: #7E7E7E;
            --radius: 28px;
        }

        body.dark-mode {
            --bg-color: #000000;
            --card-bg: #1C1C1E;
            --accent: #FFFFFF;
            --btn-sec: #2C2C2E;
            --text-main: #FFFFFF;
            --text-sub: #8E8E93;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            padding-bottom: 120px;
            transition: all 0.3s ease;
        }

        .user-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .user-header h1 { font-size: 24px; margin: 0; }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        h2 { font-size: 18px; margin-top: 0; margin-bottom: 15px; }

        button {
            background: var(--accent);
            color: var(--bg-color);
            border: none;
            padding: 15px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }

        button.secondary { background: var(--btn-sec); color: var(--text-main); }
        
        input, select {
            background: var(--btn-sec);
            border: none;
            padding: 12px;
            border-radius: 15px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--text-main);
            outline: none;
        }

        .bottom-nav {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 450px; background: #1A1A1A; height: 75px;
            border-radius: 38px; display: flex; justify-content: space-around;
            align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); z-index: 1000;
        }
        
        .nav-item { cursor: pointer; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .nav-item img { width: 24px; height: 24px; object-fit: contain; filter: brightness(0) invert(1); opacity: 0.5; }
        .nav-item.active { background: rgba(255,255,255,0.15); }
        .nav-item.active img { opacity: 1; }

        .view { display: none; }
        .view.active { display: block; }

        /* Torch Style */
        .torch-container { text-align: center; padding: 40px 0; }
        .torch-status { margin-top: 20px; font-size: 14px; color: var(--text-sub); }
    </style>
</head>
<body>

    <div class="user-header">
        <div>
            <p id="today-date" style="font-size: 14px; color: var(--text-sub); margin: 0;"></p>
            <h1 id="view-title">Eszk√∂z√∂k</h1>
        </div>
        <div style="width: 40px; height: 40px; background: var(--btn-sec); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">U</div>
    </div>

    <div id="view-tools" class="view active">
        <div class="card">
            <div id="display" style="font-size: 36px; text-align: right; margin-bottom: 15px; font-weight: bold;">0</div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                <button class="secondary" onclick="append('7')">7</button>
                <button class="secondary" onclick="append('8')">8</button>
                <button class="secondary" onclick="append('9')">9</button>
                <button onclick="append('/')">/</button>
                <button class="secondary" onclick="append('4')">4</button>
                <button class="secondary" onclick="append('5')">5</button>
                <button class="secondary" onclick="append('6')">6</button>
                <button onclick="append('*')">*</button>
                <button class="secondary" onclick="append('1')">1</button>
                <button class="secondary" onclick="append('2')">2</button>
                <button class="secondary" onclick="append('3')">3</button>
                <button onclick="append('-')">-</button>
                <button class="secondary" onclick="clearCalc()">C</button>
                <button class="secondary" onclick="append('0')">0</button>
                <button onclick="calculate()">=</button>
                <button onclick="append('+')">+</button>
            </div>
        </div>
        <div class="card">
            <h2>Valutav√°lt√≥</h2>
            <input type="number" id="curr-input" placeholder="√ñsszeg...">
            <div style="display:flex; gap:10px;">
                <select id="curr-from"></select>
                <select id="curr-to"></select>
            </div>
            <button onclick="convertCurrency()">√Åtv√°lt√°s</button>
            <p id="curr-res" style="text-align: center; font-weight: bold; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="view-shop" class="view">
        <div class="card">
            <h2>Lista</h2>
            <div style="display: flex; gap: 10px;"><input type="text" id="shop-input" style="margin:0"><button onclick="addItem()" style="width:60px">+</button></div>
            <div id="shop-list" style="margin-top:15px"></div>
        </div>
    </div>

    <div id="view-mem" class="view">
        <div class="card">
            <h2>Eml√©kek</h2>
            <input type="file" id="img-input" style="display:none" onchange="saveMem(this)">
            <button onclick="document.getElementById('img-input').click()">K√©p felt√∂lt√©se</button>
        </div>
        <div id="gallery" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
    </div>

    <div id="view-torch" class="view">
        <div class="card torch-container">
            <div style="font-size: 50px; margin-bottom: 20px;">üî¶</div>
            <h2>Zsebl√°mpa</h2>
            <button class="switch" id="torch-btn">BE / KI</button>
            <div class="torch-status" id="console">K√©szen √°ll</div>
        </div>
    </div>

    <div id="view-settings" class="view">
        <div class="card">
            <h2>Be√°ll√≠t√°sok</h2>
            <button class="secondary" onclick="toggleDarkMode()">S√∂t√©t m√≥d</button>
            <button onclick="resetAll()" style="background:#FF3B30; color:white; margin-top:20px">T√∂rl√©s</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="nav('tools', this)"><img src="tools.png"></div>
        <div class="nav-item" onclick="nav('shop', this)"><img src="shoplist.png"></div>
        <div class="nav-item" onclick="nav('mem', this)"><img src="memories.png"></div>
        <div class="nav-item" onclick="nav('torch', this)"><img src="torch.png"></div>
        <div class="nav-item" onclick="nav('settings', this)"><img src="settings.png"></div>
    </nav>

    <script>
        // --- ZSEBL√ÅMPA SCRIPT INTEGR√ÅCI√ì ---
        let track = null;
        let isTorchOn = false;
        const consoleOutput = document.getElementById("console");
        const log = (msg) => { consoleOutput.innerText = msg; };

        async function initTorch() {
            if (!('mediaDevices' in navigator)) return log("Nem t√°mogatott b√∂ng√©sz≈ë");
            
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const cameras = devices.filter(d => d.kind === 'videoinput');
                if (cameras.length === 0) return log("Nincs kamera");

                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                
                track = stream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(track);
                const capabilities = await imageCapture.getPhotoCapabilities();

                if (capabilities.torch) {
                    document.getElementById('torch-btn').addEventListener('click', async () => {
                        try {
                            isTorchOn = !isTorchOn;
                            await track.applyConstraints({ advanced: [{ torch: isTorchOn }] });
                            log(isTorchOn ? "Vil√°g√≠t" : "Kikapcsolva");
                        } catch (e) { log("Hiba: " + e); }
                    });
                } else { log("Nincs zsebl√°mpa hardver"); }
            } catch (err) { log("Enged√©ly megtagadva"); }
        }

        // --- ALAP FUNKCI√ìK ---
        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            el.classList.add('active');
            if(id === 'torch' && !track) initTorch();
            if(id === 'mem') renderMem();
        }

        // Sz√°mol√≥g√©p / Valuta / Lista (r√∂vid√≠tve az olvashat√≥s√°g√©rt, funkci√≥k maradnak)
        let ex = "";
        function append(v) { ex += v; document.getElementById('display').innerText = ex; }
        function clearCalc() { ex = ""; document.getElementById('display').innerText = "0"; }
        function calculate() { try { ex = eval(ex).toString(); document.getElementById('display').innerText = ex; } catch { ex = ""; }}

        async function loadCurrencyList() {
            const r = await fetch('https://api.frankfurter.app/currencies');
            const d = await r.json();
            const f = document.getElementById('curr-from'), t = document.getElementById('curr-to');
            Object.keys(d).forEach(c => { f.add(new Option(c, c)); t.add(new Option(c, c)); });
            f.value = "EUR"; t.value = "HUF";
        }

        async function convertCurrency() {
            const a = document.getElementById('curr-input').value, f = document.getElementById('curr-from').value, t = document.getElementById('curr-to').value;
            if(!a) return;
            const r = await fetch(`https://api.frankfurter.app/latest?amount=${a}&from=${f}&to=${t}`);
            const d = await r.json();
            document.getElementById('curr-res').innerText = `${a} ${f} = ${d.rates[t].toLocaleString()} ${t}`;
        }

        function toggleDarkMode() { localStorage.setItem('dark', document.body.classList.toggle('dark-mode')); }
        
        let items = JSON.parse(localStorage.getItem('l')) || [];
        function renderShop() { const c = document.getElementById('shop-list'); c.innerHTML = ''; items.forEach((it, i) => { c.innerHTML += `<div style="display:flex; justify-content:space-between; background:var(--btn-sec); padding:12px; border-radius:15px; margin-bottom:8px;"><span>${it}</span><span onclick="del(${i})" style="color:#FF3B30">‚úï</span></div>`; }); localStorage.setItem('l', JSON.stringify(items)); }
        function addItem() { const i = document.getElementById('shop-input'); if(i.value){items.push(i.value); i.value=''; renderShop();}}
        function del(i) { items.splice(i,1); renderShop(); }

        function saveMem(input) { const r = new FileReader(); r.onload = (e) => { const m = JSON.parse(localStorage.getItem('m')) || {}; m[new Date().toLocaleDateString()] = e.target.result; localStorage.setItem('m', JSON.stringify(m)); renderMem(); }; r.readAsDataURL(input.files[0]); }
        function renderMem() { const g = document.getElementById('gallery'); const m = JSON.parse(localStorage.getItem('m')) || {}; g.innerHTML = ''; Object.keys(m).reverse().forEach(d => { g.innerHTML += `<div><img src="${m[d]}" style="width:100%; border-radius:15px; aspect-ratio:1/1; object-fit:cover;"><p style="font-size:10px; text-align:center;">${d}</p></div>`; }); }
        function resetAll() { if(confirm("T√∂rl√©s?")){localStorage.clear(); location.reload();}}

        document.getElementById('today-date').innerText = new Date().toLocaleDateString('hu-HU', {weekday:'long', month:'long', day:'numeric'});
        if(localStorage.getItem('dark') === 'true') document.body.classList.add('dark-mode');
        loadCurrencyList();
        renderShop();
    </script>
</body>
</html>