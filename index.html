<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindenes - Seg√©dalkalmaz√°s</title>
    <style>
        :root {
            --bg-color: #F2F2F2;
            --card-bg: #FFFFFF;
            --accent: #1A1A1A;
            --btn-sec: #EBEBEB;
            --text-main: #000000;
            --text-sub: #7E7E7E;
            --radius: 28px;
        }

        body.dark-mode {
            --bg-color: #000000;
            --card-bg: #1C1C1E;
            --accent: #FFFFFF;
            --btn-sec: #2C2C2E;
            --text-main: #FFFFFF;
            --text-sub: #8E8E93;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            padding-bottom: 120px;
            transition: all 0.3s ease;
        }

        .user-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .user-header h1 { font-size: 24px; margin: 0; }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        h2 { font-size: 18px; margin-top: 0; margin-bottom: 15px; }

        button {
            background: var(--accent);
            color: var(--bg-color);
            border: none;
            padding: 15px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }

        button.secondary { background: var(--btn-sec); color: var(--text-main); }
        
        input, select {
            background: var(--btn-sec);
            border: none;
            padding: 12px;
            border-radius: 15px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--text-main);
            outline: none;
        }

        /* Navig√°ci√≥ */
        .bottom-nav {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 500px; background: #1A1A1A; height: 75px;
            border-radius: 38px; display: flex; justify-content: space-around;
            align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); z-index: 1000;
        }
        
        .nav-item { cursor: pointer; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .nav-item img { width: 24px; height: 24px; object-fit: contain; filter: brightness(0) invert(1); opacity: 0.5; }
        .nav-item.active { background: rgba(255,255,255,0.15); }
        .nav-item.active img { opacity: 1; }

        .view { display: none; }
        .view.active { display: block; }

        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        
        .list-item { display: flex; justify-content: space-between; align-items: center; background: var(--btn-sec); padding: 12px; border-radius: 15px; margin-bottom: 8px; }
        .gallery-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .gallery-item img { width: 100%; border-radius: 18px; aspect-ratio: 1/1; object-fit: cover; }
    </style>
</head>
<body>

    <div class="user-header">
        <div>
            <p id="today-date" style="font-size: 14px; color: var(--text-sub); margin: 0;"></p>
            <h1 id="view-title">Eszk√∂z√∂k</h1>
        </div>
        <div style="width: 40px; height: 40px; background: var(--btn-sec); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">U</div>
    </div>

    <div id="view-tools" class="view active">
        <div class="card">
            <div id="display" style="font-size: 36px; text-align: right; margin-bottom: 15px; font-weight: bold;">0</div>
            <div class="calc-grid">
                <button class="secondary" onclick="append('7')">7</button>
                <button class="secondary" onclick="append('8')">8</button>
                <button class="secondary" onclick="append('9')">9</button>
                <button onclick="append('/')">/</button>
                <button class="secondary" onclick="append('4')">4</button>
                <button class="secondary" onclick="append('5')">5</button>
                <button class="secondary" onclick="append('6')">6</button>
                <button onclick="append('*')">*</button>
                <button class="secondary" onclick="append('1')">1</button>
                <button class="secondary" onclick="append('2')">2</button>
                <button class="secondary" onclick="append('3')">3</button>
                <button onclick="append('-')">-</button>
                <button class="secondary" onclick="clearCalc()">C</button>
                <button class="secondary" onclick="append('0')">0</button>
                <button onclick="calculate()">=</button>
                <button onclick="append('+')">+</button>
            </div>
        </div>

        <div class="card">
            <h2>M√©rt√©kegys√©g v√°lt√≥</h2>
            <input type="number" id="conv-input" placeholder="√ârt√©k...">
            <div style="display:flex; gap:10px;">
                <select id="conv-from" onchange="filterUnits()"></select>
                <select id="conv-to"></select>
            </div>
            <button onclick="convertUnits()">√Åtv√°lt√°s</button>
            <p id="conv-res" style="text-align: center; font-weight: bold; margin-top: 10px;"></p>
        </div>

        <div class="card">
            <h2>Valutav√°lt√≥ (Online)</h2>
            <input type="number" id="curr-input" placeholder="√ñsszeg...">
            <div style="display:flex; gap:10px;">
                <select id="curr-from"></select>
                <select id="curr-to"></select>
            </div>
            <button onclick="convertCurrency()">√Åtv√°lt√°s</button>
            <p id="curr-res" style="text-align: center; font-weight: bold; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="view-shop" class="view">
        <div class="card">
            <h2>Bev√°s√°rl√≥lista</h2>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="shop-input" placeholder="√öj t√©tel..." style="margin:0">
                <button onclick="addItem()" style="width: 60px;">+</button>
            </div>
            <div id="shop-list" style="margin-top: 15px;"></div>
        </div>
    </div>

    <div id="view-mem" class="view">
        <div class="card">
            <h2>Napi Eml√©k</h2>
            <input type="file" id="img-input" accept="image/*" style="display: none;" onchange="saveMem(this)">
            <button id="mem-btn" onclick="document.getElementById('img-input').click()">K√©p felt√∂lt√©se</button>
            <p id="mem-info" style="font-size: 12px; color: var(--text-sub); text-align: center; margin-top:10px;"></p>
        </div>
        <div id="gallery" class="gallery-grid"></div>
    </div>

    <div id="view-torch" class="view">
        <div class="card" style="text-align: center; padding: 40px 0;">
            <div style="font-size: 50px; margin-bottom: 20px;">üî¶</div>
            <h2>Zsebl√°mpa</h2>
            <button id="torch-btn">BE / KI</button>
            <div id="console" style="margin-top:20px; font-size:12px; color:var(--text-sub);">K√©szen √°ll</div>
        </div>
    </div>

    <div id="view-settings" class="view">
        <div class="card">
            <h2>Be√°ll√≠t√°sok</h2>
            <button class="secondary" onclick="toggleDarkMode()">S√∂t√©t m√≥d v√°lt√°sa</button>
            <button onclick="resetAll()" style="background:#FF3B30; color:white; margin-top:20px;">Adatok t√∂rl√©se</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="nav('tools', this)"><img src="tools.png"></div>
        <div class="nav-item" onclick="nav('shop', this)"><img src="shoplist.png"></div>
        <div class="nav-item" onclick="nav('mem', this)"><img src="memories.png"></div>
        <div class="nav-item" onclick="nav('torch', this)"><img src="torch.png"></div>
        <div class="nav-item" onclick="nav('settings', this)"><img src="settings.png"></div>
    </nav>

    <script>
        // --- M√âRT√âKEGYS√âG V√ÅLT√ì ---
        const units = {
            hossz: { m: 1, cm: 0.01, mm: 0.001, dm: 0.1, km: 1000 },
            folyadek: { l: 1, ml: 0.001, cl: 0.01, hl: 100 },
            suly: { g: 1, dkg: 10, kg: 1000, t: 1000000, q: 100000 }
        };

        function initUnits() {
            const from = document.getElementById('conv-from');
            from.innerHTML = '';
            Object.keys(units).forEach(cat => {
                const group = document.createElement('optgroup');
                group.label = cat.toUpperCase();
                Object.keys(units[cat]).forEach(u => {
                    from.add(new Option(u, `${cat}:${u}`));
                });
            });
            filterUnits();
        }

        function filterUnits() {
            const [cat] = document.getElementById('conv-from').value.split(':');
            const to = document.getElementById('conv-to');
            to.innerHTML = '';
            Object.keys(units[cat]).forEach(u => to.add(new Option(u, u)));
        }

        function convertUnits() {
            const val = parseFloat(document.getElementById('conv-input').value);
            const [cat, fromU] = document.getElementById('conv-from').value.split(':');
            const toU = document.getElementById('conv-to').value;
            if(isNaN(val)) return;
            const res = (val * units[cat][fromU]) / units[cat][toU];
            document.getElementById('conv-res').innerText = `${val} ${fromU} = ${res.toLocaleString()} ${toU}`;
        }

        // --- VALUTAV√ÅLT√ì ---
        async function loadCurrencyList() {
            try {
                const r = await fetch('https://api.frankfurter.app/currencies');
                const d = await r.json();
                const f = document.getElementById('curr-from'), t = document.getElementById('curr-to');
                Object.keys(d).forEach(c => { f.add(new Option(c, c)); t.add(new Option(c, c)); });
                f.value = "EUR"; t.value = "HUF";
            } catch(e) {}
        }

        async function convertCurrency() {
            const a = document.getElementById('curr-input').value, f = document.getElementById('curr-from').value, t = document.getElementById('curr-to').value;
            if(!a) return;
            try {
                const r = await fetch(`https://api.frankfurter.app/latest?amount=${a}&from=${f}&to=${t}`);
                const d = await r.json();
                document.getElementById('curr-res').innerText = `${a} ${f} = ${d.rates[t].toLocaleString()} ${t}`;
            } catch(e) { alert("Hiba az online v√°lt√°sn√°l."); }
        }

        // --- EML√âKEK (MEMORIES) ---
        function saveMem(input) {
            if (!input.files || !input.files[0]) return;
            const today = new Date().toLocaleDateString();
            const m = JSON.parse(localStorage.getItem('m')) || {};
            
            if (m[today]) { alert("M√°ra m√°r r√∂gz√≠tett√©l eml√©ket!"); return; }

            const reader = new FileReader();
            reader.onload = (e) => {
                m[today] = e.target.result;
                localStorage.setItem('m', JSON.stringify(m));
                renderMem();
            };
            reader.readAsDataURL(input.files[0]);
        }

        function renderMem() {
            const g = document.getElementById('gallery');
            const m = JSON.parse(localStorage.getItem('m')) || {};
            const today = new Date().toLocaleDateString();
            g.innerHTML = '';
            
            document.getElementById('mem-btn').style.display = m[today] ? 'none' : 'block';
            document.getElementById('mem-info').innerText = m[today] ? "Mai eml√©k r√∂gz√≠tve." : "M√©g nincs m√°ra eml√©ked.";

            Object.keys(m).sort().reverse().forEach(d => {
                g.innerHTML += `<div><img src="${m[d]}"><p style="font-size:10px; text-align:center;">${d}</p></div>`;
            });
        }

        // --- ZSEBL√ÅMPA ---
        let track = null;
        async function initTorch() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                track = stream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(track);
                const caps = await imageCapture.getPhotoCapabilities();
                if (caps.torch) {
                    let on = false;
                    document.getElementById('torch-btn').onclick = async () => {
                        on = !on;
                        await track.applyConstraints({ advanced: [{ torch: on }] });
                        document.getElementById('console').innerText = on ? "Vil√°g√≠t" : "Kikapcsolva";
                    };
                }
            } catch(e) { document.getElementById('console').innerText = "Hiba vagy nem t√°mogatott eszk√∂z."; }
        }

        // --- APP ALAPOK ---
        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            el.classList.add('active');
            document.getElementById('view-title').innerText = {tools:'Eszk√∂z√∂k', shop:'Lista', mem:'Eml√©kek', torch:'Zsebl√°mpa', settings:'Be√°ll√≠t√°sok'}[id];
            if(id === 'mem') renderMem();
            if(id === 'torch' && !track) initTorch();
        }

        let ex = "";
        function append(v) { ex += v; document.getElementById('display').innerText = ex; }
        function clearCalc() { ex = ""; document.getElementById('display').innerText = "0"; }
        function calculate() { try { ex = eval(ex).toString(); document.getElementById('display').innerText = ex; } catch { ex = ""; }}

        let items = JSON.parse(localStorage.getItem('l')) || [];
        function renderShop() {
            const c = document.getElementById('shop-list'); c.innerHTML = '';
            items.forEach((it, i) => {
                c.innerHTML += `<div class="list-item"><span>${it}</span><span onclick="del(${i})" style="color:#FF3B30; cursor:pointer; font-weight:bold;">‚úï</span></div>`;
            });
            localStorage.setItem('l', JSON.stringify(items));
        }
        function addItem() { const i = document.getElementById('shop-input'); if(i.value){items.push(i.value); i.value=''; renderShop();}}
        function del(i) { items.splice(i,1); renderShop(); }

        function toggleDarkMode() { localStorage.setItem('dark', document.body.classList.toggle('dark-mode')); }
        function resetAll() { if(confirm("Minden adatot t√∂r√∂lsz?")){localStorage.clear(); location.reload();}}

        // START
        document.getElementById('today-date').innerText = new Date().toLocaleDateString('hu-HU', {weekday:'long', month:'long', day:'numeric'});
        if(localStorage.getItem('dark') === 'true') document.body.classList.add('dark-mode');
        initUnits();
        loadCurrencyList();
        renderShop();
    </script>
</body>
</html>
